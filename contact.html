<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content />
        <meta name="author" content />
        <title>Fish Run Games - Contacts</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body class="d-flex flex-column">
        <main class="flex-shrink-0">
            <!-- Navigation-->
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <div class="container px-5">
                    <a class="navbar-brand" href="index.html">Fish Run Games</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="technology.html">Technology</a></li>
                            <li class="nav-item"><a class="nav-link" href="portfolio.html">Portfolio</a></li>
                            <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
                            <li class="nav-item"><a class="nav-link" href="contact.html">Contacts</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- Page content-->
            <section class="py-5">
                <div class="container px-5">
                    <!-- Contact form-->
                    <div class="bg-light rounded-3 py-5 px-4 px-md-5 mb-5">
                        <div class="text-center mb-5">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-envelope"></i></div>
                            <h1 class="fw-bolder">Fish Run Games</h1>
                            <p class="lead fw-normal text-muted mb-0"><b>Email:</b> vladislav.khorev@fishrungames.com</p>
                            <p class="lead fw-normal text-muted mb-0"><b>Phone (primary):</b> +44 7458 197431</p>
                            <p class="lead fw-normal text-muted mb-0"><b>Phone (secondary):</b> +996 773 610568</p>
                            <p class="lead fw-normal text-muted mb-0"><b>Address:</b> Chyngyza Aitmatova 93/1 office 13</p>
                            <p class="lead fw-normal text-muted mb-3">Bishkek, Kyrgyz Republic, 720044</p>
                            <p class="lead fw-normal text-muted mb-3"><b>Telegram:</b> <a href="https://telegram.me/mephi1984">mephi1984</a></p>
                        </div>
                        <div class="row gx-5 justify-content-center">
                            <div class="col-lg-8 col-xl-6">
                                
                                <h2 class="fw-bolder mb-4">Send us a message</h2>

								<form id="contactForm">

									<div class="form-floating mb-3">
										<input class="form-control" id="name" type="text" placeholder="Enter your name..." required />
										<label for="name">Full name</label>
									</div>

									<div class="form-floating mb-3">
										<input class="form-control" id="email" type="email" placeholder="name@example.com" required />
										<label for="email">Email address</label>
									</div>

									<div class="form-floating mb-3">
										<textarea class="form-control" id="message" type="text" placeholder="Enter your message here..." style="height: 10rem" required></textarea>
										<label for="message">Message</label>
									</div>

									<div class="form-check mb-3">
										<input class="form-check-input" id="agreement" type="checkbox" required />
											<label class="form-check-label" for="agreement">
												I agree to the  
												<a href="/privacy.html" target="_blank">Privacy Policy</a>
											</label>
											<div class="invalid-feedback">You must agree before submitting.</div>
									</div>
										
									<div class="mb-3" id="captchaPlaceholder">
									</div>

									<div class="d-flex justify-content-center d-none" id="loadingSpinner">
										<div class="spinner-border text-primary" role="status">
											<span class="visually-hidden">Loading...</span>
										</div>
									</div>
									
									<div class="d-none" id="submitSuccessMessage">
										<div class="text-center mb-3 text-success">
											<div class="fw-bolder">Form submission successful!</div>
											We will contact you shortly.
										</div>
									</div>

									<div class="d-none" id="submitErrorMessage">
										<div class="text-center mb-3 text-danger">Error sending message! Please try again later.</div>
									</div>
									
									<div class="d-grid">
											<button class="btn btn-primary btn-lg disabled" id="submitButton" type="submit">Submit</button>
									</div>

								</form>
                                </div>
                        </div>
                    </div>
                    </div>
            </section>
        </main>
        <!-- Footer-->
        <footer class="bg-dark py-4 mt-auto">
            <div class="container px-5">
                <div class="row align-items-center justify-content-between flex-column flex-sm-row">
                    <div class="col-auto">
                        <div class="small m-0 text-white">Fish Run Games -
                            <script type="text/javascript">
                                document.write(new Date().getFullYear());
                            </script>
                        </div>
                    </div>
                    <div class="col-auto">
                        
                        <a class="link-light small" href="/privacy.html">Privacy Policy</a>
                        <span class="text-white mx-1">&middot;</span>
                        <!--<a class="link-light small" href="#!">Terms</a>
                        <span class="text-white mx-1">&middot;</span> -->
                        <a class="link-light small" href="contact.html">Contact</a>
                    </div>
                </div>
            </div>
        </footer>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/scripts.js"></script>
        <script src="https://www.google.com/recaptcha/api.js?render=6LfMrQQsAAAAAOo1zeALz9awzDVO8qcYFaI1PEtA" async defer></script>
        <script>
		
			const RECAPTCHA_SITE_KEY = '6LfMrQQsAAAAAOo1zeALz9awzDVO8qcYFaI1PEtA';
			
			document.addEventListener('DOMContentLoaded', function () {
				const form = document.getElementById('contactForm');
				const submitButton = document.getElementById('submitButton');
				const loadingSpinner = document.getElementById('loadingSpinner'); 
				const successMessage = document.getElementById('submitSuccessMessage');
				const errorMessage = document.getElementById('submitErrorMessage');
				const agreementCheckbox = document.getElementById('agreement'); // Получаем checkbox
				
				// --- Функция проверки валидности формы ---
				function checkFormValidity() {
					// Проверяем все обязательные поля (input, textarea)
					const inputs = form.querySelectorAll('input:required, textarea:required');
					const allInputsFilled = Array.from(inputs).every(i => i.value.trim() !== '');
					
					// Проверяем, отмечен ли чекбокс
					const isAgreed = agreementCheckbox.checked;

					// Кнопка активна, только если ВСЕ поля заполнены И согласие дано
					const formIsValid = allInputsFilled && isAgreed;
					submitButton.classList.toggle('disabled', !formIsValid);
					
					return formIsValid;
				}

				// Слушатели событий для проверки валидности при вводе
				form.querySelectorAll('input, textarea').forEach(input => {
					input.addEventListener('input', checkFormValidity);
				});
				agreementCheckbox.addEventListener('change', checkFormValidity); // Добавляем слушателя на checkbox


				// Обработчик отправки формы
				form.addEventListener('submit', async function (event) {
					event.preventDefault(); 
					
					if (!checkFormValidity()) {
						agreementCheckbox.classList.add('is-invalid');
						return;
					} else {
						 agreementCheckbox.classList.remove('is-invalid');
					}
					
					// 1. Показываем Spinner и скрываем кнопку
					submitButton.classList.add('d-none'); 
					loadingSpinner.classList.remove('d-none');
					successMessage.classList.add('d-none');
					errorMessage.classList.add('d-none');
					
					try {
						// --- Шаг 1: Получение токена reCAPTCHA ---
						let recaptchaToken = null;
						await new Promise((resolve) => {
							grecaptcha.ready(function() {
								// 'contact_submit' должен совпадать с actionName на бэкенде
								grecaptcha.execute(RECAPTCHA_SITE_KEY, {action: 'contact_submit'}).then(function(token) {
									recaptchaToken = token;
									resolve();
								});
							});
						});
						
						if (!recaptchaToken) {
							throw new Error('reCAPTCHA token generation failed.');
						}
						
						// 2. Сбор данных формы вместе с токеном
						const formData = {
							name: document.getElementById('name').value,
							email: document.getElementById('email').value,
							message: document.getElementById('message').value,
							recaptchaToken: recaptchaToken // <-- Добавляем токен
						};

						// 3. Отправка на ваш API
						const response = await fetch('https://api.fishrungames.com/api/contact', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify(formData)
						});

						// 3. Обработка ответов
						if (response.ok) {
							successMessage.classList.remove('d-none');
							form.reset(); 
							submitButton.classList.add('disabled'); 
						} else {
							const errorData = await response.json();
							console.error('Server error:', errorData.error);
							errorMessage.querySelector('div.text-danger').innerText = errorData.error || 'Error sending message! Please try again later.';
							errorMessage.classList.remove('d-none');
						}

					} catch (error) {
						// Обработка ошибок reCAPTCHA или сети
						console.error('Submission error:', error);
						errorMessage.querySelector('div.text-danger').innerText = error.message || 'Could not process submission.';
						errorMessage.classList.remove('d-none');
					} finally {
						// 5. Действия после завершения
						loadingSpinner.classList.add('d-none'); 
						submitButton.classList.remove('d-none');
					}
				});
			});
		</script>
    </body>
</html>
